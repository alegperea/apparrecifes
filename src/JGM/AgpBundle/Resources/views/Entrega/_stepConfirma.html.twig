{% extends 'AgpBundle:Default:_layout.html.twig' %}
{% block contenido %}
    <div class="x_panel">       
        <div class="x_title">
            <h2>Nueva entrega</h2>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <div id="wizard" class="form_wizard wizard_horizontal">
                <form accept-charset="UTF-8" class="form-horizontal form-label-left" enctype="multipart/form-data" method="post" action="{{ path('entrega_stepconfirmfirma', { 'id': entity.id  }) }}">

                    <ul class="wizard_steps col-md-12 col-sm-12 col-xs-12" >
                        <li>
                            <a href="#step-1" >
                                <span class="step_no">1</span>
                                <span class="step_descr">
                                    Carga de datos                                       
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#step-2" >
                                <span class="step_no">2</span>
                                <span class="step_descr">
                                    Asignaci贸n de productos
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#step-3" class="selected">
                                <span class="step_no">3</span>
                                <span class="step_descr">
                                    Confirmaci贸n
                                </span>
                            </a>
                        </li>

                    </ul>
                    <div class="ln_solid col-md-12 col-sm-12 col-xs-12"></div>

                    <div class="col-md-12 col-sm-12 col-xs-12">  
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Selecci贸n de productos</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>                                    
                                    <li><a class="close-link"><i class="fa fa-close"></i></a>
                                    </li>
                                    <li class="dropdown">
                                        <a aria-expanded="false" role="button" data-toggle="dropdown" class="dropdown-toggle" href="#"><i class="fa fa-wrench"></i></a>
                                        <ul role="menu" class="dropdown-menu">
                                            <li><a href="#">Settings 1</a>
                                            </li>
                                            <li><a href="#">Settings 2</a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <h3>{{ entity.cliente.getNombre }}</h3>
                                <p>{{ entity.fecha | date('d-m-Y') }}</p>  
                                <p>Contacto: {{ entity.cliente.contacto }}</p>
                                <p>Direcci贸n:  {{ entity.cliente.direccion }}</p> 
                                <p>Modalidad de pago:  <span class="label label-primary">{{ entity.cliente.modalidadPago }}</span></p> 

                                {% if entity.descuentoEspecial %}
                                    <span class="label label-success">Descuento especial: {{ entity.descuentoEspecial }}</span>
                                {% endif %}
                                {% if entity.pagoRealizado %}
                                    <span class="label label-success">Pago realizado: {{ entity.pagoRealizado }}</span>
                                {% endif %}
                                {% if entity.limpiezaRealizada %}
                                    <span class="label label-success">Limpieza realizada: {{ entity.limpiezaRealizada }}</span>
                                {% endif %}
                                {% if entity.co2Entregados %}
                                    <span class="label label-success">Co2 Entregados: {{ entity.co2Entregados }}</span>
                                {% endif %} 
                                {% if entity.co2Retirados %}
                                    <span class="label label-success">Co2 Retirados: {{ entity.co2Retirados }}</span>
                                {% endif %}
                                {% if entity.co2Backup %}
                                    <span class="label label-success">Co2 Backup: {{ entity.co2Backup }}</span>
                                {% endif %}
                                {% if entity.barrilesEntregados %}
                                    <span class="label label-success">Barriles Entregados: {{ entity.barrilesEntregados }}</span>
                                {% endif %} 
                                {% if entity.barrilesRetirados %}
                                    <span class="label label-success">Barriles Retirados: {{ entity.barrilesRetirados }}</span>
                                {% endif %}
                                {% if entity.barrilesCliente %}
                                    <span class="label label-success">Barriles Backup: {{ entity.barrilesCliente }}</span>
                                {% endif %}
                                <ul class="to_do">
                                    {% for producto in entity.getProductos %} 
                                        <li>
                                            <p>
                                                {{ producto.producto.nombre }}, {{ producto.producto.litros }} lts.
                                            </p>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>

                    </div>
                    
                    <div class="ln_solid col-md-12 col-sm-12 col-xs-12"></div>   
                    <div class="form-group">
                        <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-10">
                            <a href="{{ path('entrega') }}" class="guardar btn btn-primary">Volver</a>
                            <input type="submit" id="bt-save" class="guardar btn btn-success" value="Confirmar" />
                        </div>
                    </div>
            </div>
        </div>
    </div>
</div>



{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{asset('assets/js/wizard/jquery.smartWizard.js')}}"></script>
    <script>

        $(document).ready(function () {
            // Smart Wizard
            // $('#wizard').smartWizard();

            function onFinishCallback() {
                $('#wizard').smartWizard('showMessage', 'Finish Clicked');
                //alert('Finish Clicked');
            }

            var tiemposcambian = tiemposcambian || {};

            tiemposcambian.GuardandoPNGs = (function () {
                var mousePressed = false;
                var lastX, lastY;
                var ctx;

                function init() {
                    // init canvas
                    var canvas = document.getElementById('canvas');
                    ctx = canvas.getContext('2d');
                    resetCanvas();

                    // button events
                    document.getElementById('bt-save').onmouseup = sendToServer;
                    document.getElementById('bt-clear').onmouseup = resetCanvas;

                    // canvas events
                    canvas.onmousedown = function (e) {
                        draw(e.layerX, e.layerY);
                        mousePressed = true;
                    };

                    canvas.onmousemove = function (e) {
                        if (mousePressed) {
                            draw(e.layerX, e.layerY);
                        }
                    };

                    canvas.onmouseup = function (e) {
                        mousePressed = false;
                    };

                    canvas.onmouseleave = function (e) {
                        mousePressed = false;
                    };
                }

                function draw(x, y) {
                    if (mousePressed) {
                        ctx.beginPath();
                        ctx.strokeStyle = document.getElementById('color').value;
                        ctx.lineWidth = 1;
                        ctx.lineJoin = 'round';
                        ctx.moveTo(lastX, lastY);
                        ctx.lineTo(x, y);
                        ctx.closePath();
                        ctx.stroke();
                    }
                    lastX = x;
                    lastY = y;
                }

                function sendToServer() {
                    var data = canvas.toDataURL('image/png');
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function () {
                        // request complete
                        if (xhr.readyState == 4) {
                            //window.open('firmas/' + xhr.responseText, '_blank');
                        }
                    }
                    xhr.open('POST', '{{ path('entrega_create') }}', true);
                    xhr.setRequestHeader('Content-Type', 'application/upload');
                    xhr.send(data);
                }

                function resetCanvas() {
                    // just repaint canvas white
                    ctx.fillStyle = '#EEEEEE';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                return {
                    'init': init
                };
            });


            window.onload = function () {
                new tiemposcambian.GuardandoPNGs().init();
            };
        });
    </script>


{% endblock %}